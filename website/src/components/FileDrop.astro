---
// Most of this code has been modified from
// https://developer.mozilla.org/en-US/docs/Web/API/File_API/Using_files_from_web_applications
---

<input type="file" name="file" id="file-upload" accept=".zip" class="visually-hidden" />
<label id="drop-zone" for="file-upload">
    <p id="drop-zone-title">Drag and drop your level.</p>
    <p>or click to browse</p>
</label>

<script>
    const dropZone = document.querySelector<HTMLDivElement>("#drop-zone")!;
    const dropZoneTitle = document.querySelector<HTMLParagraphElement>("#drop-zone-title")!;
    const fileInput = document.querySelector<HTMLInputElement>("#file-upload")!;

    function dragPrevent(event: DragEvent) {
        event.stopPropagation();
        event.preventDefault();
    }

    function updateFiles() {
        if (!fileInput.files || fileInput.files.length === 0) return;
        const [file] = fileInput.files;

        dropZoneTitle.innerText = `To upload: ${file.name}`;
    }

    fileInput.addEventListener("change", () => updateFiles());

    dropZone.addEventListener("drop", (event) => {
        dragPrevent(event);

        const dt = event.dataTransfer;
        const files = dt?.files;

        if (files) {
            fileInput.files = files;
            updateFiles();
        }
    });

    dropZone.addEventListener("dragover", dragPrevent);
    dropZone.addEventListener("dragenter", dragPrevent);
</script>

<style lang="scss">
    // From https://developer.mozilla.org/en-US/docs/Web/API/File_API/Using_files_from_web_applications#using_a_label_element_to_trigger_a_hidden_file_input_element
    .visually-hidden {
        clip: rect(0 0 0 0);
        clip-path: inset(50%);
        height: 1px;
        overflow: hidden;
        position: absolute;
        white-space: nowrap;
        width: 1px;
    }

    input.visually-hidden:is(:focus, :focus-within) + label {
        outline: thin dotted;
    }

    #drop-zone {
        border: 2px solid black;
        width: 100%;
        height: 100px;
        cursor: pointer;

        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    p#drop-zone-title {
        font-size: 36px;
    }
</style>
